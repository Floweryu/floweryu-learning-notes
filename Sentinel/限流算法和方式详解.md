## 1. 限流

即对请求或并发数进行限制，限制一个时间窗口内请求量。

**阈值**：在一个单位时间内允许的请求量。如QPS为100，即1s内最多100个请求。

**拒绝策略**：超过阈值的请求的拒绝策略，如：直接拒绝、排队等待等。

## 2. 固定窗口算法

又叫**计数器算法**。主要通过一个支持原子操作的计数器来累计1s内的请求次数，当1s内技术达到限流阈值时触发拒绝策略。每过1s，计数器重置为0重新开始计数。

**代码示例：**

```java
public class RateLimiterSimpleWindow {
    /**
     * 阈值
     */
    private static Integer QPS = 2;
    
    /**
     * 时间窗口
     */
    private static long TIME_WINDOWS = 1000;
    
    /**
     * 计数器
     */
    private static AtomicInteger REQ_COUNT = new AtomicInteger();
    
    private static long START_TIME = System.currentTimeMillis();
    
    public synchronized static boolean tryAcquire() {
        // 如果超出时间窗口，重置计数器为0，并重新记录时间窗口起始时间
        if (System.currentTimeMillis() - START_TIME > TIME_WINDOWS) {
            System.out.println("超出时间窗口");
            REQ_COUNT.set(0);
            // 这里没有另起一个线程重置
            START_TIME = System.currentTimeMillis();
        }
        // 计数器+1，判断是否达到阈值
        return REQ_COUNT.incrementAndGet() <= QPS;
    }
    
    public static void main(String[] args) throws InterruptedException {
        for (int i = 0; i < 10; i++) {
            Thread.sleep(250);
            LocalTime now = LocalTime.now();
            if (!tryAcquire()) {
                System.out.println(now + " 被限流");
            } else {
                System.out.println(now + " 做点什么");
            }
        }
    }
}
```

运行结果：

```bash
20:54:12.521501500 做点什么
20:54:12.776000100 做点什么
20:54:13.038653300 被限流
超出时间窗口
20:54:13.299136700 做点什么
20:54:13.561623800 做点什么
20:54:13.824499100 被限流
20:54:14.085717100 被限流
超出时间窗口
20:54:14.346450500 做点什么
20:54:14.607957300 做点什么
20:54:14.870337600 被限流
```

实际上该算法是有问题的，虽然限制了QPS为2，但当遇到滑动窗口的临界处时，可能会出现下面情况：第1s的后500ms请求两次，第2s的前500ms请求两次，这时加起来是1s，但却请求