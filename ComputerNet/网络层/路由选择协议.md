## 默认路由配置

目的网络是0.0.0.0/0，下一条要进行转发的路由器的接口地址

## 特定主机路由

地址是特定主机的IP地址，路由是要转发的路由接口地址

- 为了防止IP数据报在路由环路中永久兜圈，在IP数据报首部设有生存时间TTL子段。IP数据报每次进入路由器后，TTL子段减一，若TTL的值不等于0，则被路由器转发，否则被丢弃
- 聚合了不存在的网络而导致路由环路。解决方法：添加不存在网络的黑洞路由

https://www.bilibili.com/video/BV1c4411d7jb?p=49

## 路由选择协议

### 静态路由选择

一般在小规模网络中使用，不能及时适应网络状态的变化

### 动态路由选择

适用于大型网络，能较好的适应网络状态的变化

### 分层次路由选择协议

- 自治系统内部的路由选择为域内路由选择，采用内部网关协议IGP
- 自治系统之间的路由选择为域间路由选择，采用外部网关协议EGP
- 每个自治系统使用的内部网关协议可以不同

### 内部网关协议IGP

下面两种是基于距离向量：

- 路由信息协议RIP
- 内部网关路由协议IGRP

- 增强型内部网关路由协议EIGRP

下面两种是基于链路状态：

- 开放式最短路径优先OSPF
- 中间系统到中间系统IS-IS

### 外部网关协议EGP

- 边界网关协议BGP

### 路由信息协议RIP

RIP要求自治系统内每一个路由器都要维护从它自己到自治系统内其它网络的距离记录，称为**距离向量D-V**

RIP使用跳数来衡量到达目的的网络距离

- 路由器到直连网络的距离定义为1
- 路由器到非直连网络的距离定义为所经过的路由器加1
- 允许一条路径最多只能包含15个路由器。$\color{red}{“距离”等于16时相当于不可达}$。

所以，RIP只适用于小型互联网

- RIP规定，好的路由就是距离短的路由
- 当有多个距离相等的路由时，RIP进行等价负载均衡，将通信量均衡分布在多条等价路由上。

RIP包含下面三个要点：

- 和谁交换信息 ——仅和相邻路由器交换信息
- 交换什么信息——自己的路由表
- 何时交换信息——周期性交换

更新规则：

- 到达目的网络，相同的下一跳，最新消息
- 发现了新网络，添加
- 到达目的网络，不同下一跳，新路由为优势，更新
- 到达目的网络，不同的下一跳，距离相等，可以等价负载均衡，添加
- 到达目的网络，不同的下一跳，新路由距离长，不更新

![image-20200607100724630](静态路由配置.assets/image-20200607100724630.png)

### 习题

![image-20200607102031823](静态路由配置.assets/image-20200607102031823.png)

## 开放最短路径优先OSPF协议

### 基本概念

- OSPF基于链路状态
- OSPF采用SPF算法，保证了不会产生路由环路
- OSPF不限制网络规模，更新效率高，收敛速度快
- 链路状态是指路由器都和哪些路由器相邻，以及相应链路的代价
- OSPF相邻路由器之间通过问候分组，建立和维护邻居关系 

使用OSPF每个路由器都会产生链路状态通告LSA，包含以下内容：

- 直连网络的链路状态信息
- 邻居路由器的链路状态信息

使用OSPF各路由器基于LSDB进行最短路径优先SPF计算，构建出各自到达其他路由器的最短路径，构建各自的路由表

### 问候(Hello)分组

用来建立和维护邻居路由器的可达性

- Hello分组封装在IP数据报中，发往组播地址224.0.0.5
- 发送周期为10秒
- 40秒未收到来自邻居路由器的Hello分组，则认为该邻居路由器不可达

### 链路状态通告LSA

- 直连网络的链路状态信息
- 邻居路由器的链路状态信息

### 链路状态数据库LSDB，存储LSA

- 通告各路由器洪泛发送封装有自己LSA的LSU分组，各路由器的LSDB最终将达到一致

### 最短路径计算

各路由器基于LSDB进行最短路径优先SPF计算，构建出各自到达其他各路由器的最短路径，即构建各自的路由表

### 五种类型

#### 问候分组

用来发现和维护邻居路由器的可达性

#### 数据库描述

向邻居路由器给出自己的链路状态数据库中的所有链路状态项目的摘要信息

#### 链路状态请求

向邻居路由器请求发送某些链路状态项目的详细信息

#### 链路状态更新

将路由器链路状态洪泛发送，对全网更新链路状态

#### 链路状态确认

对链路状态更新分组的确认分组

### DR和BDR路由器

- 减少链接关系
- 所有非DR/BDR只与DR/BDR建立连接关系
- 非DR/BDR之间通过DR/BDR交换信息

### 区域

OSPF把一个自治系统再划分为若干个更小的范围，叫做区域。

#### 区域内路由器IR

#### 区域边界路由器ABR

#### 主干路由器BBR

#### 自治系统边界路由器ASBR

![image-20200607121808429](静态路由配置.assets/image-20200607121808429.png)

## 边界网关协议BGP

#### OPEN(打开)报文

用来与相邻的另一个BGP发言人建立关系，使通信初始化

#### UPDATE(更新)报文

用来通告某一路由的信息，以及列出要撤销的多条路由

#### KEEPALIVE(保活)报文

用来周期性证实邻站的连通性

#### NOTIFICATION(通知)报文

用来发送检测到的差错

### 习题

![image-20200607123213299](路由选择协议.assets/image-20200607123213299.png)

## 封装关系

封装RIP的协议是：UDP

封装OSPF的协议是：IP

封装BGP的协议是：TCP

