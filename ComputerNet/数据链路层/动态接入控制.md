## 载波监听多址接入/碰撞检测 CSMA/CD

**总线局域网使用协议(有线网络)**

### 载波监听CS

每一个站在发送帧之前先要检测一下总线上是否有其他站点在发送帧（先听后说）

- 若检测到总线空闲96比特时间，则发送这个帧
- 若检测到总线忙，则继续检测并等待总线转为空闲96比特时间，然后发送这个帧

### 多址接入MA

多个站点链接在一条总线上，竞争使用总线

### 碰撞检测CD

每个正在发送帧的站边发送边检测碰撞（边说边听）

当检测到碰撞后，除了立即停止发送帧以外，还要发送32比特或48比特的认为干扰信号，以便有足够多的碰撞信号使所有站点能够检测到碰撞

### 争用期

- 主机最多经过2τ的时长就可检测到本次发送是否遭受了碰撞
- 以太网端到端往返传播时延2τ称为争用期或碰撞窗口
- 经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞
- 每个主机在自己发送帧之后的一小段时间内，存在者遭遇碰撞的可能性。这一小段时间是不确定的，它取决于另一个发送帧的主机到本主机的距离，但不会超过总线的端到端往返传播时延，即一个争用期时间。
- 在以太网中，发送帧的主机越多，端到端往返传播时延越大。因此，共享式以太网不能连接太多主机，使用的总线也不能太长。

### 最小帧长

- 以太网规定最小帧长为64字节，即512比特（512比特时间即为争用期）

- 如果要发送的数据非常小，必须加入一些填充字节，使帧长不小于64字节

- **以太网的最小帧长确保了主机可在帧发送完成之前就检测到该帧的发送过程中是否遭遇了碰撞**

- 如果在争用期（共发送64字节）没有检测到碰撞，那么后续发送的数据就一定不会发生碰撞

- 如果在争用期内检测到碰撞，就立即终止发送，这时已经发送出去的数据一定小于64字节。因此，凡长度小于64字节的帧都是由于碰撞二异常终止的无效帧。

  ​					$$最小帧长=争用期*数据传输速率$$

### 最大帧长

- 以太网V2的MAC帧（最大长度为1518字节）数据载荷1500字节不小于46字节，目的地址6字节，原地址6字节，类型2字节，FCS是4字节
- 插入VLAN标记后的802.1Q帧（最大长度为1522字节）数据载荷42~1500字节，目的地址6字节，原地址6字节，VLAN标记4字节，类型2字节，FCS是4字节

### 截断二进制指数退避算法

退避时间 = 基本退避时间 x 随机数 r

- 基本退避时间——争用期 2τ
- 随机数 r ——从离散整数集合0~$2^{k-1}$中随机挑选，k = min(重传次数，10)

![image-20200605211717685](动态接入控制.assets/image-20200605211717685.png)

- 若连续发生多次碰撞，表明可能有较多的主机参与竞争信道。使用退避算法可使重传需要推迟的平均时间随重传次数而增大（也称动态退避），因而减小发生碰撞的概率，有利于整个系统的稳定
- 当重传达到16次仍不能成功时，表明同时打算发送帧的主机太多，以至于连续发生碰撞，则丢弃该帧，并向高层报告

### 信道利用率

发送时间/发送时间+τ

### CSMA/CD 发送流程图

![image-20200605211928335](动态接入控制.assets/image-20200605211928335.png)

### CSMA/CD接收流程图

![image-20200605212014580](动态接入控制.assets/image-20200605212014580.png)

### 题目

![image-20200605213740909](动态接入控制.assets/image-20200605213740909.png)

## 载波监听多址接入/碰撞避免CSMA/CA

**无线局域网使用的协议**

### 802.11标准

802.11MAC层标准定义了两种不同的媒体接入方式：

- **分布式协调功能DCF**。在DCF方式下，没有中心控制站点，每个站点使用CSMA/CA协议通过争用信道来获取发送权
- **点协调功能PCF**。PCF方式使用集中控制的接入算法（一般在接入点AP实现集中控制），是802.11定义的可选方式，在实际中较少使用

### 帧间间隔IFS

- 802.11标准规定，所有的站点都必须在持续监测到信道空闲一段指定时间后才能发送帧，这段时间为帧间间隔IFS

帧间间隔的长短取决于该站点要发送的帧的类型：

1. 高优先级需要等待的时间较短，可优先获得发送权。

2. 低优先级需要等待的时间较长。若某个站的低优先级帧还没来得及发送，而其他站的高优先级帧已发送到信道上，则信道变为忙态，因而低优先级帧就只能推迟发送

#### 短帧间间隔SIFS(28us)

是最短的帧间间隔，**用来分隔开属于一次对话的各帧**。**一个站点应该能够在这段时间内从发送方式切换到接收方式**。使用SIFS的帧类型有ACK帧、CTS帧、由过长的MAC帧分片后的数据帧、以及所有回答AP探询的帧和在PCF方式中接入点AP发送出的任何帧。

#### DCF帧间间隔DIFS(128us)

比短帧间间隔SIFS要长的多，在DCF方式中用来发送数据帧和管理帧。

### 退避算法

在执行退避算法时，站点为退避计时器设置一个随机的退避之间

- 当退避计时器的时间减小到零时，就开始发送数据
- 当退避计时器还未减小到零时而信道又转变为忙状态，这时就冻结退避计时器的数值，重新等待信道变为空闲，再经过时间DIFS后，继续启动退避计时器

在执行第i次退避时，退避时间在时隙编号2的n次方中随机选择一个，然后乘以基本退避时间（也就是基本时隙长度）就可以得到随机的退避时间。使站点选择相同退避时间的概率减少。当时隙编号到255时（即第六次）就不再增加

### 信道预约和虚拟载波监听

为尽可能减少碰撞概率和降低碰撞的影响，802.11标准允许要发送数据的站点对信道进行预约。

1. 源站在发送数据帧之前先发送一个短的数据帧，称为请求发送RTS，包括源地址、目的地址以及这次通信所需的持续时间
2. 若目的站正确收到源站发来的RTS帧，且媒体空闲，就发送一个响应控制帧，称为允许发送CTS，也包括此次通信所需的持续时间
3. 源站收到CTS帧后，再等待一段时间SIFS后，就可发送其数据帧
4. **若目的站正确收到了源站发来的数据帧，在等待时间SIFS后，就向源站发送确认帧ACK**

除源站和目的站以外的其他各站，在收到CTS帧（或数据帧）后就推迟接入到无线局域网中。这样就保证源站和目的站之间的通信不会受到其他站的干扰。

如果RTS帧发生碰撞，源站就收不到CTS帧，需执行退避算法重传RTS帧。

**除RTS帧和CTS帧携带通信所需要的时间，数据帧也能携带通信所需要的时间，称为802.11的虚拟载波监听机制**

**使用虚拟载波监听机制，站点只需要监听到RTS、CTS帧或数据帧中的任何一个，就能知道信道占用的时间**

## 总结

- 在无线局域网中，仍然可以使用CSMA协议：即在发送帧之前先对传输媒体进行载波监听。若发现有其他站在发送帧，就推迟发送以免发生故障
- **在无线局域网中不能使用CD协议**，原因如下：1. 无线信道的传输条件特殊，信号强度的动态范围非常大，无线网卡接受到的信号强度远远小于发送信号的强度。如果要在无线网卡山实现碰撞检测CD，对硬件的要求非常高。2. 即使能够在硬件上实现无线局域网的碰撞检测功能，但由于无线电波传播的特殊性（存在隐蔽站问题），进行碰撞检测的意义也不大
- CSMA/CD和CSMA/CA都能在有线局域网中使用